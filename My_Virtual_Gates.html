<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>冬笋云 | 虚拟网关</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.7 -->
    <link rel="stylesheet" href="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <!-- Bootstrap switch -->
    <link rel="stylesheet" href="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/bootstrap-switch/css/bootstrap-switch.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/font-awesome/css/font-awesome.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
    <!-- DataTables-Responsive -->
    <link rel="stylesheet" href="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/DataTables-Responsive/css/responsive.dataTables.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/Ionicons/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="http://thingscloud.oss-cn-beijing.aliyuncs.com/dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="http://thingscloud.oss-cn-beijing.aliyuncs.com/dist/css/skins/_all-skins.min.css">

    <!-- global style -->
    <link rel="stylesheet" href="user_css/global.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <!--<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>-->
    <!--<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>-->
    <![endif]-->

    <!-- Google Font -->
    <!--<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">-->
    <style type="text/css">

        .table tr {
            height: 50px;!important;
        }
        .table th, .table td {
            /*text-align: center;*/
            vertical-align: middle!important;
        }

    </style>

</head>

<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    <!-- top Nav menu start. -->
    <header class="main-header">
        <!-- Logo -->
        <a href="index.html" class="logo">
            <!-- mini logo for sidebar mini 50x50 pixels -->
            <span class="logo-mini"><b>冬</b></span>
            <!-- logo for regular state and mobile devices -->
            <span class="logo-lg"><b>冬笋云</b></span>
        </a>
        <!-- Header Navbar: style can be found in header.less -->
        <nav class="navbar navbar-static-top">
            <!-- Sidebar toggle button-->
            <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                <span class="sr-only">Toggle navigation</span>
            </a>

            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">
                    <!-- User Account: style can be found in dropdown.less -->
                    <li class="dropdown tasks-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="fa  fa-user-md"></i>
                            <span class="hidden-xs user-name" data-accesskey="">user</span>
                        </a>
                        <ul class="dropdown-menu"  style="width: 180px;padding: 15px">

                            <li>
                                <!-- inner menu: contains the actual data -->
                                <ul class="menu">
                                    <li><!-- Task item -->
                                        <a href="User_Settings.html">
                                            <h3>
                                                <i class="fa fa-user"></i>
                                                基本资料
                                            </h3>
                                        </a>
                                    </li>

                                    <li><!-- Task item -->
                                        <a href="My_Virtual_Gates.html">
                                            <h3>
                                                <i class="fa fa-laptop"></i>
                                                虚拟网关
                                            </h3>
                                        </a>
                                    </li>

                                    <li><!-- Task item -->
                                        <a href="My_AccessKey.html">

                                            <h3>
                                                <i class="fa fa-key"></i>
                                                AccessKey
                                            </h3>
                                        </a>
                                    </li>

                                </ul>
                            </li>

                            <!-- Menu Footer-->
                            <li class="user-footer">

                                <div>
                                    <a href="javascript:logout();"  class="btn btn-warning btn-block btn-flat">退出</a>
                                </div>
                            </li>

                        </ul>
                    </li>
                    <!-- Help can be found in dropdown.less -->
                    <li class="dropdown tasks-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="fa  fa-question-circle"></i>
                            帮助
                        </a>
                        <ul class="dropdown-menu"  style="width: 180px;padding: 15px">

                            <li>
                                <!-- inner menu: contains the actual data -->
                                <ul class="menu">
                                    <li><!-- Task item -->
                                        <a target="_blank" href="/guide">

                                            <h3>
                                                <i class="fa fa-users text-aqua"></i>
                                                快速指南
                                            </h3>
                                        </a>
                                    </li>

                                    <li><!-- Task item -->
                                        <a target="_blank" href="https://freeioe.gitbook.io/doc">

                                            <h3>
                                                <i class="fa fa-users text-aqua"></i>
                                                应用开发手册
                                            </h3>
                                        </a>
                                    </li>

                                    <li><!-- Task item -->
                                        <a href="#">

                                            <h3>
                                                <i class="fa fa-users text-aqua"></i>
                                                平台开发手册
                                            </h3>
                                        </a>
                                    </li>

                                </ul>
                            </li>

                        </ul>
                    </li>
                    <!-- Control Sidebar Toggle Button -->
                    <li>
                        <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>
    <!-- top Nav menu end. -->

    <!-- Left Nav menu start. contains the logo and sidebar -->
    <aside class="main-sidebar">
        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">
            <!-- sidebar menu: : style can be found in sidebar.less -->
            <ul class="sidebar-menu" data-widget="tree">

                <li class="header">Dashboard</li>

                <li><a href="index.html"><i class="fa fa-dashboard"></i> <span>Dashboard</span></a></li>

                <li class="header">我的资源</li>
                <li><a href="My_Gates_list.html"><i class="fa fa-laptop  text-green"></i> <span>我的网关</span></a></li>
                <li><a href="My_Apps_list.html"><i class="fa fa-th  text-teal"></i> <span>我的应用</span></a></li>
                <li><a href="My_Template_list.html"><i class="fa fa-table  text-purple"></i> <span>我的模板</span></a></li>

                <li class="header">消息中心</li>
                <li><a href="User_Platform_Messages.html"><i class="fa fa-commenting-o text-yellow"></i> <span>平台消息</span></a></li>
                <li><a href="User_Device_Messages.html"><i class="fa fa-commenting-o text-light-blue"></i> <span>设备消息</span></a></li>


            </ul>
        </section>
        <!-- /.sidebar -->
    </aside>
    <!-- Left Nav menu end. contains the logo and sidebar -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                个人信息
                <small>虚拟网关</small>
                <div class="pull-right"><a href="javascript:history.back(-1);"><button type="button" class="btn btn-default"><i class="fa fa-reply"></i>返回</button></a></div>

            </h1>
            <!--<ol class="breadcrumb">-->
                <!--<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>-->
                <!--<li class="active">Dashboard</li>-->
            <!--</ol>-->
        </section>

        <!-- Main content -->
        <section class="content">

            <div class="row">


                <div class="col-md-12">
                    <div class="box box-body " style="min-height: 370px">
                        <div class="btn-group">
                            <button type="button" class="btn btn-default virtual_gate-refresh"><i class="fa fa-refresh"></i></button>

                        </div>

                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-primary new_virtual_gate">申请虚拟网关</button>
                            </div>
                        </div>


                        <table id="Virtual_Gates" class="table display" style="width:100%">
                            <thead>
                            <tr>
                                <th style="width:28%; min-width:330px">虚拟网关序列号</th>
                                <th style="width:6%; min-width:50px">状态</th>
                                <th style="min-width:250px">网关名称</th>
                                <th style="min-width:250px">网关描述</th>
                                <th style="width:8%; min-width:80px">操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            </tbody>
                        </table>


                    </div>

                </div>
                <!-- /.col -->
            </div>
            <!-- /.row -->

            <section>
                <h2 class="page-header"># 虚拟网关使用指南</h2>
                <p class="lead">点击下载：<a href="http://thingscloud.oss-cn-beijing.aliyuncs.com/download/freeioe.zip">FreeIOE虚拟网关</a>  MD5:24E3C9D773BCA05F292D7BF78402A8F6</p>
                <h3>运行FreeIOE虚拟网关</h3>
                <p>将下载的FreeIOE.zip解压，使用虚拟机软件(VMware Workstation 或者 VirtualBox)打开
                </p>
                <h3>使用VMware Workstation运行FreeIOE说明</h3>
                <ol>
                    <li>在解压后的目录下双击freeioe.ovf文件，在Windows系统在会自动使用VMware Workstation打开并弹出导入界面，如下图所示：<br>
                        <img src="img/freeioe/01.jpg">
                    </li>
                    <br>
                    <li>FreeIOE虚拟机基于OPEWRT系统，默认带2块网卡，第一块网卡是LAN口，连接主机的虚拟网卡1；第二块网卡是WAN口，连接到主机的物理网卡。<span class="text-red">可根据自己的网络环境修改。</span></li>
                    <br>
                    <li>启动虚拟机，等待十几秒FreeIOE启动完成后，<span class="text-red">在虚拟机中按回车键查看虚拟机的IP地址，</span>如下图所示：<br>
                        <img src="img/freeioe/02.jpg">
                    </li>
                    <br>
                    <li>FreeIOE虚拟机运行后，登录地址为上一条所说的<span class="text-red">虚拟机运行起来后看到的IP地址，</span>使用浏览器登录到FreeIOE系统，http://xxx.xxx.xxx.xxx:8808，登录后界面如下图所示：<br>
                        <img src="img/freeioe/03.jpg" style="width: 80%">
                    </li>
                    <br>
                    <li>登录FreeIOE系统，<span class="text-red">默认的用户名/密码：admin/admin1</span></li>
                    <br>
                    <li>登录后，在左侧导航中点击云，进行FreeIOE连接平台的<span class="text-red">序列号修改</span>，如下图所示：
                    <br>
                        <img src="img/freeioe/04.jpg" style="width: 80%">
                    </li>
                    <br>
                    <li>将自己账户下的<span class="text-red">虚拟网关序列号选择一个（在本页面的上面表格中，如没有，申请即可）</span>，复制并填入云ID文本框中，点击修改后，再点击下方的重启按钮重启FreeIOE即可。 </li>
                    <br>
                    <li>登录平台后，在自己的名下就出现了刚增加的FreeIOE虚拟网关，给它改个名称，接下来就开始体验吧。</li>
                </ol>

            </section>

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->



    <!-- Control Sidebar start-->
    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Create the tabs -->
        <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
            <li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>

            <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
        </ul>
        <!-- Tab panes -->
        <div class="tab-content">
            <!-- Home tab content -->
            <div class="tab-pane" id="control-sidebar-home-tab">


            </div>
            <!-- /.tab-pane -->
            <!-- Stats tab content -->
            <div class="tab-pane" id="control-sidebar-stats-tab">Stats Tab Content</div>
            <!-- /.tab-pane -->
            <!-- Settings tab content -->
            <div class="tab-pane" id="control-sidebar-settings-tab">

            </div>
            <!-- /.tab-pane -->
        </div>
    </aside>
    <!-- /.control-sidebar -->
    <!-- /.control-sidebar end-->


    <!-- Add the sidebar's background. This div must be placed
         immediately after the control sidebar -->
    <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- jQuery 3 -->
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/jquery/dist/jquery.min.js"></script>
<script src="user_js/common/oem.js"></script> <!-- jQuery UI 1.11.4 -->
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/jquery-ui/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    $.widget.bridge('uibutton', $.ui.button);
</script>
<!-- jQuery 3 -->
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/jquery/dist/jquery.min.js"></script>
<script src="user_js/common/oem.js"></script> <!-- jQuery UI 1.11.4 -->
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/jquery-ui/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    $.widget.bridge('uibutton', $.ui.button);
</script>
<!-- Bootstrap 3.3.7 -->
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- Bootstrap switch -->
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/bootstrap-switch/js/bootstrap-switch.min.js"></script>
<!-- bootstrap-notify -->
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/bootstrap-notify/js/bootstrap-notify.min.js"></script>
<!-- DataTables -->
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/DataTables-Responsive/js/dataTables.responsive.min.js"></script>
<!-- SlimScroll -->
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="http://thingscloud.oss-cn-beijing.aliyuncs.com/bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.min.js"></script>
<script src="user_js/common/skin.js"></script>

<!-- load common js-->
<script src="user_js/common/jQuery.cookie.js"></script>
<script src="user_js/common/common.js"></script>
<!--<script src="user_js/common/add_back_task.js"></script>-->
<script src="user_js/common/user.js"></script>
<script>
    $(function () {
        pagename="Virtual_Gates";
        // get_virtual_gates();

        /**
         *	获取用户虚拟网关
         */
        function get_virtual_gates() {
            // var userid = getCookie('usr');
            $.ajax({
                url: '/apis/api/method/iot_ui.iot_api.get_virtual_gates?' + Date.parse(new Date()),
                headers: {
                    Accept: "application/json; charset=utf-8",
                    "X-Frappe-CSRF-Token": auth_token
                },
                type: 'get',
                contentType: "application/json; charset=utf-8",
                dataType:'json',
                success:function(req){
                    console.log(req);
                },
                error:function(req){
                    console.log(req);

                }
            });
        }



    });
</script>

<script>
    var    virtual_gates_url="/apis/api/method/iot_ui.iot_api.get_virtual_gates";
    var    table_virtual_gates = $('#Virtual_Gates').DataTable({
        "dom":"",
        "filter": false,
        "info": false,
        "paging": false,
        "searching":false,
        "iDisplayLength" : 5,
        // "lengthMenu": [ 10, 20, 50, 75, 100 ],
        "processing": false,
        "bStateSave": false,
        "fnDraw":false,
        "order": [[ 0, "asc" ]],
        "ajax": {
            "url": virtual_gates_url,
            "type": "GET",
            "error": function (e) {
                console.log(e)
            },
            "dataSrc":  function (d) {
                if($.isEmptyObject(d)){
                    return []
                }else{
                    return d.message
                }}
        },
        "columns": [
            {"data": "device_sn"},
            {"data": "device_status"},
            {"data": "device_name"},
            {"data": "device_desc"},
            {"data": null}
        ],
        "language": {
            "sProcessing": "处理中...",
            "sLengthMenu": "显示 _MENU_ 项结果",
            "sZeroRecords": "没有匹配结果",
            "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
            "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
            "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
            "sInfoPostFix": "",
            "sSearch": "搜索:",
            "sUrl": "",
            "sEmptyTable": "未找到网关",
            "sLoadingRecords": "载入中...",
            "sInfoThousands": ",",
            "oPaginate": {
                "sFirst": "首页",
                "sPrevious": "上页",
                "sNext": "下页",
                "sLast": "末页"
            },
            "oAria": {
                "sSortAscending": ": 以升序排列此列",
                "sSortDescending": ": 以降序排列此列"
            }
        },
        columnDefs: [
            {
                //   指定第2列
                targets: 1,
                searchable: false,
                render: function(row, type, data, meta) {
                    if(row=="ONLINE"){
                        return '<i class="fa fa-circle text-success"></i>' +  '<span class="text-success">  在线</span>';
                    }
                    else if(row=="OFFLINE"){
                        return '<i class="fa fa-circle text-yellow"></i>' +  '<span class="text-yellow">  离线</span>';
                    }
                    else{
                        return '<i class="fa fa-circle text-gray"></i>' +  '<span class="text-gray">  未连接</span>';
                    }
                }
            },
            {
                //   指定第最后一列
                targets: 4,
                searchable: false,
                orderable: false,
                render: function(row, type, data, meta) {
                    console.log(data.status);
                    var gen_html = '-- | --'
                    if(data.device_status=="ONLINE"){
                        var gen_html = '<a href="/My_Gates_devices.html?sn=' + data.device_sn + '">设备</a>'
                            + ' | '
                            + '<a href="/My_Gates_apps.html?sn=' + data.device_sn + '" data-sn="'+ data.device_sn +  '">应用</a>'
                    }
                    return gen_html;
                }
            }],
        "initComplete": function(settings, json) {
            console.log("init over");
            $("body").on("click", "a.Delete_Virgate", function() {
                console.log($(this).data("sn"));

            });

        }
    });



    /**
     *	新建用户虚拟网关
     */
    function new_virtual_gate() {
        $.ajax({
            url: '/apis/api/method/iot_ui.iot_api.new_virtual_gate?' + Date.parse(new Date()),
            headers: {
                Accept: "application/json; charset=utf-8",
                "X-Frappe-CSRF-Token": auth_token
            },
            type: 'post',
            contentType: "application/json; charset=utf-8",
            dataType:'json',
            success:function(req){
                // console.log(req);
                table_virtual_gates.ajax.url(virtual_gates_url).load(null,false);
            },
            error:function(req){
                console.log(req);
                if(req.responseJSON){
                    $.notify({
                        title: "<strong>添加虚拟网关失败</strong><br><br> ",
                        message: JSON.parse(JSON.parse(req.responseJSON._server_messages)[0])['message']
                    },{
                        newest_on_top: false,
                        type: "warning"
                    });

                }

            }
        });
    }


    /**
     *	删除用户虚拟网关
     */
    function delete_virtual_gate(virtual_sn) {
        $.ajax({
            url: '/apis/api/method/iot_ui.iot_api.delete_virtual_gate?' + Date.parse(new Date()),
            headers: {
                Accept: "application/json; charset=utf-8",
                "X-Frappe-CSRF-Token": auth_token
            },
            type: 'post',
            data:{"virtual_sn":virtual_sn},
            contentType: "application/json; charset=utf-8",
            dataType:'json',
            success:function(req){
                console.log(req);
            },
            error:function(req){
                console.log(req);

            }
        });
    }


    $("button.new_virtual_gate").click(function(){
        new_virtual_gate();
    });

    $("button.virtual_gate-refresh").click(function(){
        table_virtual_gates.ajax.url(virtual_gates_url).load(null,false);
    });
</script>
</body>
</html>
